import { fireEvent, render } from "@testing-library/react";
import Ephemeris from "./Ephemeris";

describe("ephemeris modal component", () => {
  it("should render the table", () => {
    expect.hasAssertions();
    const { getByText } = render(
      <Ephemeris
        ephemeris={
          '"{\\"PSRJ\\": \\"J1537+1155\\", \\"RAJ\\": \\"15:37:09.961730\\", \\"RAJ_ERR\\": \\"0.00000300000000000000\\", \\"DECJ\\": \\"+11:55:55.43387\\", \\"DECJ_ERR\\": \\"0.00006000000000000000\\", \\"F0\\": \\"26.382132776893970001\\", \\"F0_ERR\\": \\"1.1e-13\\", \\"F1\\": \\"-1.686097e-15\\", \\"F1_ERR\\": \\"2e-21\\", \\"F2\\": \\"1.7e-29\\", \\"F2_ERR\\": \\"1.1e-30\\", \\"PEPOCH\\": \\"52077\\", \\"POSEPOCH\\": \\"52077\\", \\"DMEPOCH\\": \\"58605.610306199996558\\", \\"DM\\": \\"11.613633504474631914\\", \\"DM_ERR\\": \\"0.00578854674013626249\\", \\"PMRA\\": \\"1.482\\", \\"PMRA_ERR\\": \\"0.00700000000000000000\\", \\"PMDEC\\": \\"-25.285\\", \\"PMDEC_ERR\\": \\"0.01200000000000000000\\", \\"PX\\": \\"0.86000000000000000001\\", \\"PX_ERR\\": \\"0.18000000000000000001\\", \\"SINI\\": \\"0.97719999999999999999\\", \\"SINI_ERR\\": \\"0.00160000000000000000\\", \\"BINARY\\": \\"DD\\", \\"PB\\": \\"0.420737298879\\", \\"PB_ERR\\": \\"0.00000000000200000000\\", \\"T0\\": \\"52076.827113263000001\\", \\"T0_ERR\\": \\"0.00000001100000000000\\", \\"A1\\": \\"3.7294636\\", \\"A1_ERR\\": \\"0.00000060000000000000\\", \\"OM\\": \\"283.30601200000000001\\", \\"OM_ERR\\": \\"0.00001200000000000000\\", \\"ECC\\": \\"0.27367752\\", \\"ECC_ERR\\": \\"0.00000007000000000000\\", \\"PBDOT\\": \\"-1.366e-13\\", \\"PBDOT_ERR\\": \\"2.9999999999999999999e-16\\", \\"OMDOT\\": \\"1.755795\\", \\"OMDOT_ERR\\": \\"0.00000190000000000000\\", \\"M2\\": \\"1.35\\", \\"M2_ERR\\": \\"0.05000000000000000000\\", \\"GAMMA\\": \\"0.0020708000000000000001\\", \\"GAMMA_ERR\\": \\"0.00000050000000000000\\", \\"START\\": \\"2020-04-23T23:32:52.248106Z\\", \\"FINISH\\": \\"2020-09-04T16:34:57.466691Z\\", \\"TZRMJD\\": \\"59000.781389930187444\\", \\"TZRFRQ\\": \\"1076.2680000000000291\\", \\"TZRSITE\\": \\"meerkat\\", \\"TRES\\": \\"80.070\\", \\"EPHVER\\": \\"5\\", \\"CLK\\": \\"TT(TAI)\\", \\"UNITS\\": \\"TDB\\", \\"TIMEEPH\\": \\"IF99\\", \\"DILATEFREQ\\": \\"Y\\", \\"PLANET_SHAPIRO\\": \\"Y\\", \\"T2CMETHOD\\": \\"TEMPO\\", \\"NE_SW\\": \\"4.000\\", \\"CORRECT_TROPOSPHERE\\": \\"N\\", \\"EPHEM\\": \\"DE405\\", \\"NITS\\": \\"1\\", \\"NTOA\\": \\"179\\", \\"CHI2R\\": \\"0.0000\\", \\"CHI2R_ERR\\": \\"177\\", \\"TIMEOFFSETS\\": [{\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58550_58690_1K\\", \\"display\\": \\"-0.000306243\\", \\"offset\\": \\"-0.000306243\\", \\"fit\\": \\"-0.000306243\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58526.21089_1K\\", \\"display\\": \\"-2.4628e-05\\", \\"offset\\": \\"-2.4628e-05\\", \\"fit\\": \\"-2.4628e-05\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58550.14921_1K\\", \\"display\\": \\"2.463e-05\\", \\"offset\\": \\"2.463e-05\\", \\"fit\\": \\"2.463e-05\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58550.14921B_1K\\", \\"display\\": \\"-1.196e-06\\", \\"offset\\": \\"-1.196e-06\\", \\"fit\\": \\"-1.196e-06\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58557.14847_1K\\", \\"display\\": \\"-4.785e-06\\", \\"offset\\": \\"-4.785e-06\\", \\"fit\\": \\"-4.785e-06\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58575.9591_1K\\", \\"display\\": \\"5.981308411e-07\\", \\"offset\\": \\"5.981308411e-07\\", \\"fit\\": \\"5.981308411e-07\\"}], \\"P0\\": 0.0379044411783046, \\"P0_ERR\\": 2e-16}"'
        }
        updated={{}}
        show={true}
        setShow={() => {}}
      />
    );
    expect(getByText("Folding Ephemeris")).toBeInTheDocument();
  });

  it("should close when the cross is clicked", () => {
    expect.hasAssertions();
    const setShow = vi.fn();
    const { getByRole } = render(
      <Ephemeris
        ephemeris={
          '"{\\"PSRJ\\": \\"J1537+1155\\", \\"RAJ\\": \\"15:37:09.961730\\", \\"RAJ_ERR\\": \\"0.00000300000000000000\\", \\"DECJ\\": \\"+11:55:55.43387\\", \\"DECJ_ERR\\": \\"0.00006000000000000000\\", \\"F0\\": \\"26.382132776893970001\\", \\"F0_ERR\\": \\"1.1e-13\\", \\"F1\\": \\"-1.686097e-15\\", \\"F1_ERR\\": \\"2e-21\\", \\"F2\\": \\"1.7e-29\\", \\"F2_ERR\\": \\"1.1e-30\\", \\"PEPOCH\\": \\"52077\\", \\"POSEPOCH\\": \\"52077\\", \\"DMEPOCH\\": \\"58605.610306199996558\\", \\"DM\\": \\"11.613633504474631914\\", \\"DM_ERR\\": \\"0.00578854674013626249\\", \\"PMRA\\": \\"1.482\\", \\"PMRA_ERR\\": \\"0.00700000000000000000\\", \\"PMDEC\\": \\"-25.285\\", \\"PMDEC_ERR\\": \\"0.01200000000000000000\\", \\"PX\\": \\"0.86000000000000000001\\", \\"PX_ERR\\": \\"0.18000000000000000001\\", \\"SINI\\": \\"0.97719999999999999999\\", \\"SINI_ERR\\": \\"0.00160000000000000000\\", \\"BINARY\\": \\"DD\\", \\"PB\\": \\"0.420737298879\\", \\"PB_ERR\\": \\"0.00000000000200000000\\", \\"T0\\": \\"52076.827113263000001\\", \\"T0_ERR\\": \\"0.00000001100000000000\\", \\"A1\\": \\"3.7294636\\", \\"A1_ERR\\": \\"0.00000060000000000000\\", \\"OM\\": \\"283.30601200000000001\\", \\"OM_ERR\\": \\"0.00001200000000000000\\", \\"ECC\\": \\"0.27367752\\", \\"ECC_ERR\\": \\"0.00000007000000000000\\", \\"PBDOT\\": \\"-1.366e-13\\", \\"PBDOT_ERR\\": \\"2.9999999999999999999e-16\\", \\"OMDOT\\": \\"1.755795\\", \\"OMDOT_ERR\\": \\"0.00000190000000000000\\", \\"M2\\": \\"1.35\\", \\"M2_ERR\\": \\"0.05000000000000000000\\", \\"GAMMA\\": \\"0.0020708000000000000001\\", \\"GAMMA_ERR\\": \\"0.00000050000000000000\\", \\"START\\": \\"2020-04-23T23:32:52.248106Z\\", \\"FINISH\\": \\"2020-09-04T16:34:57.466691Z\\", \\"TZRMJD\\": \\"59000.781389930187444\\", \\"TZRFRQ\\": \\"1076.2680000000000291\\", \\"TZRSITE\\": \\"meerkat\\", \\"TRES\\": \\"80.070\\", \\"EPHVER\\": \\"5\\", \\"CLK\\": \\"TT(TAI)\\", \\"UNITS\\": \\"TDB\\", \\"TIMEEPH\\": \\"IF99\\", \\"DILATEFREQ\\": \\"Y\\", \\"PLANET_SHAPIRO\\": \\"Y\\", \\"T2CMETHOD\\": \\"TEMPO\\", \\"NE_SW\\": \\"4.000\\", \\"CORRECT_TROPOSPHERE\\": \\"N\\", \\"EPHEM\\": \\"DE405\\", \\"NITS\\": \\"1\\", \\"NTOA\\": \\"179\\", \\"CHI2R\\": \\"0.0000\\", \\"CHI2R_ERR\\": \\"177\\", \\"TIMEOFFSETS\\": [{\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58550_58690_1K\\", \\"display\\": \\"-0.000306243\\", \\"offset\\": \\"-0.000306243\\", \\"fit\\": \\"-0.000306243\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58526.21089_1K\\", \\"display\\": \\"-2.4628e-05\\", \\"offset\\": \\"-2.4628e-05\\", \\"fit\\": \\"-2.4628e-05\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58550.14921_1K\\", \\"display\\": \\"2.463e-05\\", \\"offset\\": \\"2.463e-05\\", \\"fit\\": \\"2.463e-05\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58550.14921B_1K\\", \\"display\\": \\"-1.196e-06\\", \\"offset\\": \\"-1.196e-06\\", \\"fit\\": \\"-1.196e-06\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58557.14847_1K\\", \\"display\\": \\"-4.785e-06\\", \\"offset\\": \\"-4.785e-06\\", \\"fit\\": \\"-4.785e-06\\"}, {\\"type\\": \\"JUMP\\", \\"mjd\\": \\"-MJD_58575.9591_1K\\", \\"display\\": \\"5.981308411e-07\\", \\"offset\\": \\"5.981308411e-07\\", \\"fit\\": \\"5.981308411e-07\\"}], \\"P0\\": 0.0379044411783046, \\"P0_ERR\\": 2e-16}"'
        }
        updated={{}}
        show={true}
        setShow={setShow}
      />
    );
    const closeButton = getByRole("button");
    fireEvent.click(closeButton);
    expect(setShow).toHaveBeenCalledWith(false);
  });
});
